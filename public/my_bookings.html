<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Restoran - Meri Bookings</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <!-- Bootstrap CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom Stylesheet (Aapki website ka style) -->
    <link href="/css/style.css" rel="stylesheet">
    <style>
        body {
            background-color: #f1f8ff; /* Light color for background */
            font-family: 'Nunito', sans-serif;
            padding-top: 50px;
        }

        .container {
            max-width: 1000px;
        }

        .table thead {
            background-color: #FEA116;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #0F172B;
        }

        /* Status classes for color coding */
        .status-confirmed { color: green; font-weight: bold; }
        .status-pending { color: orange; font-weight: bold; }
        .status-cancelled { color: red; font-weight: bold; }
    </style>
</head>

<body>
    <!-- Simple Navbar/Header -->
    <div class="header-bar fixed-top" style="background-color: #0F172B; color: white;">
        <div class="container d-flex justify-content-between align-items-center">
            <h3 class="m-0"><a href="/" style="color: white; text-decoration: none;">üè† Home</a></h3>
            <a href="/logout" class="btn btn-sm btn-primary py-2 px-3">Logout</a>
        </div>
    </div>

    <div class="container mt-5 pt-5">
        <h1 class="mb-4 text-center" style="color: #0F172B;">Meri Bookings (My Reservations)</h1>
        
        <div id="bookingTableContainer">
            <!-- Loading Message -->
            <div id="loading" class="loading">Aapki bookings load ho rahi hain...</div>
            
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover" id="bookingsTable" style="display:none;">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Date & Time</th>
                            <th>People</th>
                            <th>Special Request</th>
                            <th>Status</th> 
                        </tr>
                    </thead>
                    <tbody id="bookingsBody">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- No Data Message -->
            <div id="noData" class="loading" style="display:none;">Aapne abhi tak koi booking nahi ki hai.</div>
        </div>
    </div>

    <!-- JavaScript for Data Fetching -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const bookingsTable = document.getElementById('bookingsTable');
            const bookingsBody = document.getElementById('bookingsBody');
            const loading = document.getElementById('loading');
            const noData = document.getElementById('noData');

            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return new Date(dateString).toLocaleTimeString('en-US', options);
            }
            
            function getStatusClass(status) {
                if (status === 'Confirmed') return 'status-confirmed';
                if (status === 'Cancelled') return 'status-cancelled';
                return 'status-pending';
            }

            function fetchUserBookings() {
                loading.style.display = 'block';
                bookingsTable.style.display = 'none';
                bookingsBody.innerHTML = '';
                noData.style.display = 'none';

                // Yahaan hum naye API route ko call karenge
                fetch('/my-bookings-data')
                    .then(response => {
                        if (!response.ok) {
                             // Agar session nahi hai (logged out), toh login par bhej dega
                            window.location.href = '/login/Login Animation/index.html'; 
                            throw new Error('User not logged in or failed to fetch data.');
                        }
                        return response.json();
                    })
                    .then(result => {
                        loading.style.display = 'none';

                        if (result.success && result.data.length > 0) {
                            bookingsTable.style.display = 'table';
                            
                            result.data.forEach((booking, index) => {
                                const row = bookingsBody.insertRow();
                                
                                row.insertCell(0).textContent = index + 1;
                                row.insertCell(1).textContent = formatDate(booking.datetime);
                                row.insertCell(2).textContent = booking.people;
                                row.insertCell(3).textContent = booking.message || 'N/A';
                                
                                // Status Cell
                                const statusCell = row.insertCell(4);
                                statusCell.innerHTML = `<span class="${getStatusClass(booking.status)}">${booking.status}</span>`;
                            });
                        } else {
                            noData.style.display = 'block';
                            noData.textContent = result.message || 'Aapne abhi tak koi booking nahi ki hai.';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching bookings:', error);
                        if (error.message.includes('logged in')) {
                            return; // Redirect ho chuka hai
                        }
                        loading.textContent = '‚ùå Bookings load karne mein error: ' + error.message;
                        loading.style.color = 'red';
                        loading.style.display = 'block';
                    });
            }

            fetchUserBookings(); // Page load hone par data fetch karein
        });
    </script>
</body>

</html>